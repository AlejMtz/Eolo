<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../../public/assets/css/style.css">
    <script src="../../public/assets/js/auth_check.js"></script>
    <title>Detalle de Walkaround</title>

</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark navbar-custom">
        <div class="container">
            <a href="../../app/views/Index.html" class="navbar-brand">
                <i class="fas fa-plane"></i> EOLO - Sistema de Walkaround
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="../../app/views/ver_aeronaves.html"><i class="fas fa-plane"></i> Aeronaves</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../../app/views/ver_aeropuertos.html"><i class="fas fa-map-marker-alt"></i> Aeropuertos</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../../app/views/ver_walkaround.html"><i class="fas fa-clipboard-check"></i> Walkaround</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../../app/views/ver_entrega_turno.html"><i class="fas fa-images"></i> Entrega de Turno</a>
                    </li>
                </ul>
            </div>
        </div>

        <div class="navbar-nav ms-auto">
            <span class="navbar-text text-light me-3" id="userInfo"></span>
            <button class="btn btn-outline-light btn-sm" onclick="cerrarSesion()">
                <i class="fas fa-sign-out-alt me-1"></i>Cerrar Sesión
            </button>
        </div>
    </nav>

    <div class="container container-form mt-4">
        <h2 class="form-title"><i class="fas fa-clipboard-check"></i> Detalle de Walkaround</h2>
    </div>

    <!-- Información de permisos -->
    <div id="infoPermisos"></div>

    <div class="container mt-4">
        <!-- Información general -->
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-info-circle"></i> Información General</h5>
            </div>
            <div class="card-body">
                <div class="row" id="infoGeneral">
                    <div class="col-md-4">
                        <p><strong>Fecha y Hora:</strong> <span id="fechaHoraInfo"></span></p>
                        <p><strong>Aeronave:</strong> <span id="aeronaveInfo"></span></p>
                        <p><strong>Tipo Aeronave:</strong> <span id="equipoInfo"></span></p>
                    </div>
                    <div class="col-md-4">
                        <p><strong>Tipo de Walkaround:</strong> 
                            <span id="tipoWalkaroundInfo"></span>
                        </p>
                        <p><strong>Procedencia:</strong> <span id="procedenciaInfo"></span></p>
                        <p><strong>Destino:</strong> <span id="destinoInfo"></span></p>
                    </div>
                    <div class="col-md-4">
                        <p><strong>Elaboró:</strong> <span id="elaboroInfo"></span></p>
                        <p><strong>Responsable:</strong> <span id="responsableInfo"></span></p>
                        <p><strong>Jefe de Área:</strong> <span id="jefeAreaInfo"></span></p>
                        <p><strong>VoBo:</strong> <span id="voboInfo"></span></p>
                    </div>
                </div>
                <div class="mt-3" id="observacionesGeneral">
                    <strong>Observaciones Generales:</strong>
                    <p id="observacionesInfo" class="text-muted"></p>
                </div>
            </div>
        </div>

        <!-- COMPONENTES CON SCROLL HORIZONTAL COMPLETO CORREGIDO -->
<div class="card mb-4">
    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
        <h5 class="mb-0"><i class="fas fa-cogs me-2"></i>Componentes de la Aeronave</h5>
        <span class="badge bg-light text-primary desktop-only">Desplaza horizontalmente →</span>
    </div>
    <div class="card-body p-0">
        <!-- Indicador de scroll para móviles -->
        <div class="scroll-hint mobile-only">
            <i class="fas fa-arrows-left-right"></i> 
            Desliza horizontalmente para ver todos los tipos de daño
            <i class="fas fa-arrows-left-right"></i>
        </div>
        
        <!-- CONTENEDOR PRINCIPAL CON SCROLL HORIZONTAL COMPLETO -->
        <div class="components-main-container">
            <!-- HEADER FIJO QUE SE DESPLAZA HORIZONTALMENTE -->
            <div class="global-table-header">
                <table class="table table-bordered table-sm mb-0">
                    <thead>
                        <tr>
                            <th>COMPONENTE</th>
                            <th>DERECHO</th>
                            <th>IZQUIERDO</th>
                            <th>GOLPE</th>
                            <th>RAYÓN</th>
                            <th>FISURA</th>
                            <th>QUEBRADO</th>
                            <th>PINT. CUARTEADA</th>
                            <th>OTRO DAÑO</th>
                        </tr>
                    </thead>
                </table>
            </div>
            
            <!-- CONTENIDO CON SCROLL HORIZONTAL COMPLETO -->
            <div class="components-content" id="componentesContainer">
                <!-- El contenido se genera dinámicamente aquí -->
            </div>
        </div>
    </div>
</div>

        <!-- Evidencias -->
        <div class="card mb-4">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0"><i class="fas fa-images"></i> Evidencias</h5>
            </div>
            <div class="card-body">
                <div id="evidenciasContainer">
                    <div class="text-center py-4">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Cargando...</span>
                        </div>
                        <p class="mt-2">Cargando evidencias...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Botones de acción con permisos -->
        <div class="d-flex gap-2 mb-4">
            <a href="../../app/views/ver_walkaround.html" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Volver a la lista
            </a>
            
            <!-- Botón Editar (condicional) -->
            <button id="btnEditar" class="btn btn-warning btn-editar" data-modulo="walkarounds">
                <i class="fas fa-edit"></i> Editar
            </button>
            
            <!-- Botón Eliminar (condicional) -->
            <button id="btnEliminar" class="btn btn-danger btn-eliminar" data-modulo="walkarounds">
                <i class="fas fa-trash"></i> Eliminar
            </button>
        </div>
    </div>

    <!-- Modales -->
    <div class="modal fade" id="errorModal" tabindex="-1" aria-labelledby="errorModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title" id="errorModalLabel">
                        <i class="fas fa-exclamation-triangle me-2"></i>¡Error! ⚠️
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="errorModalBody"></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Aceptar</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../../public/assets/js/detalle_walkaround.js"></script>
    <script src="../../public/assets/js/permisos.js"></script>

    <script>
        // Verificar permisos al cargar la página
        document.addEventListener('DOMContentLoaded', function() {
            if (!verificarSesion()) return;
            
            // Verificar acceso al módulo
            if (!permisosSistema.verificarAccesoPagina('walkarounds')) {
                return;
            }
            
            permisosSistema.aplicarPermisosUI();
        });
    </script>
</body>
</html>